## Зачем нужен Shadow DOM?

1. **Капсуляция.**  
    Shadow DOM позволяет скрыть внутреннюю реализацию компонента, его структуру и стили от остальной части приложения. Это помогает предотвратить конфликты CSS и обеспечивает независимость компонента.
    
    - **Изоляция CSS:** Стили, определённые внутри Shadow DOM, не влияют на элементы вне него, и наоборот, глобальные стили страницы не затрагивают содержимое теневого дерева. Это позволяет создавать компоненты с собственным оформлением, которое не будет случайно изменено из внешнего мира.
	- **Изоляция DOM-структуры:** Внутренняя структура компонента скрыта от остальной части приложения, что помогает предотвратить нежелательное взаимодействие или манипуляции извне.
    
2. **Повторное использование компонентов.**  
    Компоненты, построенные с использованием Shadow DOM, могут быть легко повторно использованы, поскольку их внутренняя логика и стили не пересекаются с глобальными настройками.
    
3. **Безопасность.**  
    Изоляция внутренней структуры компонента помогает избежать нежелательных изменений, поскольку внешние скрипты и стили не могут случайно изменить содержимое теневого DOM.

## Как работает Shadow DOM?

1. **Host-элемент.**  
    На странице располагается обычный HTML-элемент, который будет «хозяином» для теневого DOM.
    
2. **Прикрепление теневого DOM.**  
    С помощью метода `attachShadow()` к host-элементу создаётся теневое DOM-дерево (shadow tree).

```JS
const hostElement = document.querySelector('.my-component');
const shadowRoot = hostElement.attachShadow({ mode: 'open' });
```
**Изолированное дерево.**  
Внутри `shadowRoot` создаются любые элементы, стили и логика, которые будут принадлежать только этому теневому DOM. Это дерево является независимым от основного DOM-дерева документа.


## Схема работы Shadow DOM

```plain
          +------------------------+
          |      Document          |   <-- Основной (light) DOM
          |                        |
          |  +------------------+  |
          |  |  Host Element    |  |   <-- Элемент, к которому прикреплён теневой DOM
          |  | (например, <my-comp>)  |
          |  +------------------+  |
          |         | attachShadow()|
          |         v             |
          |  +------------------+  |   <-- Shadow Root (теневое DOM-дерево)
          |  |  Shadow Root     |  |
          |  |   (shadow tree)  |  |
          |  |  +------------+  |  |   <-- Вложенные элементы внутри теневого DOM
          |  |  |  Internal  |  |  |
          |  |  |   Nodes    |  |  |
          |  |  +------------+  |  |
          |  +------------------+  |
          +------------------------+
```

- **Document (Light DOM):** Основное DOM-дерево, которое браузер формирует из HTML-страницы.
- **Host Element:** Элемент, к которому прикрепляется Shadow DOM.
- **Shadow Root:** Корень теневого DOM, созданный с помощью `attachShadow()`, инкапсулирующий внутреннюю структуру компонента.
- **Internal Nodes:** Вложенные элементы внутри теневого DOM, которые полностью изолированы от внешнего DOM.

## Shadow DOM в Angular

В Angular для инкапсуляции стилей и изоляции шаблона компонента от внешнего DOM можно использовать механизм, основанный на Shadow DOM. При этом Angular не создает свою собственную имитацию (как при использовании режима Emulated), а использует нативный механизм браузера. Рассмотрим, как это работает:

### 1. Режимы инкапсуляции в Angular

Angular поддерживает несколько стратегий инкапсуляции стилей:

- **Emulated (по умолчанию):**  
    Angular добавляет уникальные атрибуты к элементам компонента и генерирует селекторы для CSS, чтобы стили применялись только к данному компоненту. При этом фактически используется основной DOM, а инкапсуляция симулируется на уровне селекторов.
    
- **ShadowDom:**  
    Angular использует нативный Shadow DOM браузера. Это означает, что для компонента создается настоящее изолированное теневое дерево, в котором размещается шаблон, а стили применяются только к элементам внутри этого дерева.
    
- **None:**  
    Стили компонента применяются глобально, инкапсуляция отсутствует.
    

Чтобы использовать нативный Shadow DOM, нужно в метаданных компонента установить свойство `encapsulation` в значение `ViewEncapsulation.ShadowDom`.


## Итог

Shadow DOM является мощным инструментом для создания изолированных, повторно используемых компонентов с собственной структурой и стилями. Он помогает избежать конфликтов в большом приложении, гарантируя, что внутренние элементы компонента не будут случайно изменены внешними факторами.